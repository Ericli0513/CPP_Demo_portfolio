name: C++ Multi-Project CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install build tools
      run: sudo apt update && sudo apt install build-essential -y

    # === cpp-pipeline-demo ===
    - name: Build cpp-pipeline-demo
      run: make
      working-directory: cpp-pipeline-demo

    - name: List files (cpp-pipeline-demo)
      run: ls -R
      working-directory: cpp-pipeline-demo

    - name: Upload cpp-pipeline-demo artifact
      uses: actions/upload-artifact@v4
      with:
        name: cpp-pipeline-demo
        path: |
          cpp-pipeline-demo/bin/*
          cpp-pipeline-demo/build/*
          cpp-pipeline-demo/*.out
          cpp-pipeline-demo/*.exe

    # === driver_test_project ===
    - name: Build driver_test_project
      run: make
      working-directory: driver_test_project

    - name: List files (driver_test_project)
      run: ls -R
      working-directory: driver_test_project

    - name: Upload driver_test_project artifact
      uses: actions/upload-artifact@v4
      with:
        name: driver-test
        path: |
          driver_test_project/bin/*
          driver_test_project/build/*
          driver_test_project/*.out
          driver_test_project/*.exe

    # === module_integration_project1 ===
    - name: Build module_integration_project1
      run: make
      working-directory: module_integration_project1

    - name: List files (module_integration_project1)
      run: ls -R
      working-directory: module_integration_project1

    - name: Upload module_integration_project1 artifact
      uses: actions/upload-artifact@v4
      with:
        name: module1
        path: |
          module_integration_project1/bin/*
          module_integration_project1/build/*
          module_integration_project1/*.out
          module_integration_project1/*.exe

    # === module_integration_project2 ===
    - name: Build module_integration_project2
      run: make
      working-directory: module_integration_project2

    - name: List files (module_integration_project2)
      run: ls -R
      working-directory: module_integration_project2

    - name: Upload module_integration_project2 artifact
      uses: actions/upload-artifact@v4
      with:
        name: module2
        path: |
          module_integration_project2/bin/*
          module_integration_project2/build/*
          module_integration_project2/*.out
          module_integration_project2/*.exe

    # === sys_monitor_project ===
    - name: Build sys_monitor_project
      run: make
      working-directory: sys_monitor_project

    - name: List files (sys_monitor_project)
      run: ls -R
      working-directory: sys_monitor_project

    - name: Upload sys_monitor_project artifact
      uses: actions/upload-artifact@v4
      with:
        name: sys-monitor
        path: |
          sys_monitor_project/bin/*
          sys_monitor_project/build/*
          sys_monitor_project/*.out
          sys_monitor_project/*.exe

    # === tv_integration_project ===
    - name: Build tv_integration_project
      run: make
      working-directory: tv_integration_project

    - name: List files (tv_integration_project)
      run: ls -R
      working-directory: tv_integration_project

    - name: Upload tv_integration_project artifact
      uses: actions/upload-artifact@v4
      with:
        name: tv-integration
        path: |
          tv_integration_project/bin/*
          tv_integration_project/build/*
          tv_integration_project/*.out
          tv_integration_project/*.exe
